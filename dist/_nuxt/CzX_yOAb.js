import{_ as le,a as se}from"./BzVEqXPg.js";import{_ as re,a as ne,b as ie}from"./Be2iH8Rx.js";import{a as ce}from"./Crp9aCmO.js";import{d as de,i as ue,u as pe,r as d,V as M,k as w,o as m,c as y,f as r,w as i,g as l,F as L,h as s,z as g,x as V,v as me,e as fe,s as _e}from"./RPcYXXev.js";import{_ as be}from"./yGFOaDKw.js";import{_ as ve}from"./N6g2mK6h.js";import{_ as ye}from"./lE0Kizl1.js";import{_ as Ce}from"./DHKz6DHT.js";import{_ as he}from"./E1zpYRWT.js";import{_ as Oe}from"./D923ZLaS.js";import{u as C}from"./BqkbertX.js";import"./B4XmkEM1.js";import"./BYchAQ3Y.js";import"./DTMMRf-M.js";import"./CZ9EiQCe.js";import"./CBKg8vbb.js";import"./rJN6zrQ_.js";import"./3snQ80t5.js";import"./C1sp2X5w.js";import"./OsgMrgDf.js";import"./BQUlXvKt.js";import"./Dw6iTx8h.js";import"./CtWjGfD-.js";import"./DFiUDov5.js";const xe=s("div",{class:"px-4 py-2 gmsPurpleTitlebar"},[s("h2",null,"Sort")],-1),ge={class:"flex flex-row space-x-3"},ke={class:"basis-1/5 max-w-[300px] min-w-[150px] mr-4"},Se={class:"basis-1/5 max-w-[300px] min-w-[150px]"},De={class:"text-bold"},Ne={class:"basis-1/5 max-w-[300px] min-w-[150px]"},Ie={class:"text-bold"},Ee={class:"basis-1/5 max-w-[300px] min-w-[150px]"},Re={class:"text-bold"},Te={class:"flex flex-row space-x-2"},Pe=s("div",{class:"px-4 py-2 gmsPurpleTitlebar"},[s("h2",null,"Order Lookup")],-1),Ue={class:"flex flex-row px-10 mt-4"},Me={class:"basis-1/5"},we={key:0,class:"min-w-[200px]"},Le={class:"border-t-[1px] border-gray-200 mb-1 dark:border-gray-800"},Ve={class:"flex flex-row justify-end mr-20 mt-1"},B="i-heroicons-bars-arrow-up-20-solid",A="i-heroicons-bars-arrow-down-20-solid",$="i-heroicons-arrows-up-down-20-solid",ct=de({__name:"list",setup(Be){ue(()=>{x()}),pe({title:"Grimm-Service Orders"});const h=d(0),k=d(0),f=d({productLines:{label:"Product Line",filter:"PRODUCTDESC",api:"/api/materials/productlines",options:[]}}),S=d({open:{label:"Open",filterKey:"OPENCASE",isChecked:!0},cryotherm:{label:"CRYOTherm Checkup",filterKey:"CRYOThermCheckup",isChecked:!1},nonMedical:{label:"Non-Medical Device",filterKey:"NonMedicalDevice",isChecked:!1},complaints:{label:"Complaints",filterKey:"ValidComplaint",isChecked:!1},injury:{label:"Injury",filterKey:"INJURYREPORTNO",isChecked:!1}}),e=d({defaultColumns:[{key:"COMPLAINTNUMBER",label:"SO#",sortable:!0,sortDirection:"none",filterable:!0},{key:"SERIALNO",label:"Serial#",sortable:!0,sortDirection:"none",filterable:!0},{key:"COMPLAINTDATE",label:"Date",sortable:!0,sortDirection:"none",filterable:!0},{key:"FAILINVEST",label:"Failure Comment",sortable:!0,sortDirection:"none",filterable:!0},{key:"company1",label:"Company",sortable:!0,sortDirection:"none",filterable:!0},{key:"Status",label:"Status"},{key:"INJURYREPORTNO",label:"Injury"},{key:"Warranty",label:"Warranty"},{key:"Complaint",label:"Complaint"}],page:1,pageSize:50,numberOfServiceOrders:0,orders:[],selectedOrderId:null,selectedCustomerId:null,selectedCompaintNumber:null,selectedSerialNumber:null,sort:{column:"COMPLAINTNUMBER",direction:"desc"},isLoading:!1}),_=d({isServiceOrderModalOpen:!1}),n=d({PRODUCTDESC:null,COMPLAINTNUMBER:null,SERIALNO:null,COMPLAINTDATE:null,FAILINVEST:null,company1:null,OPENCASE:!0,CRYOThermCheckup:null,NonMedicalDevice:null,ValidComplaint:null,INJURYREPORTNO:null}),p=(t,o)=>{M(()=>S.value[t].isChecked,u=>{n.value[o]=u?"1":"0"})};p("injury","INJURYREPORTNO"),p("open","OPENCASE"),p("cryotherm","CRYOThermCheckup"),p("nonMedical","NonMedicalDevice"),p("complaints","ValidComplaint"),M(()=>n.value.PRODUCTDESC,()=>N());const F=w(()=>k.value===0?0:Math.round(h.value/k.value*100)),j=d(e.value.defaultColumns),D=d(!1),O=w(()=>e.value.defaultColumns.filter(t=>j.value.includes(t))),x=async()=>{var t;e.value.isLoading=!0,b(),N();for(const o in f.value){const u=((t=f.value[o])==null?void 0:t.api)??`/api/service/orders/${o}`;await C(u,{method:"GET",onResponse({response:c}){c.status===200&&(f.value[o].options=[null,...c._data.body])}})}},b=async()=>{e.value.isLoading=!0,await C("/api/service/orders/numbers",{method:"GET",params:{...n.value},onResponse({response:t}){t.status===200&&(e.value.numberOfServiceOrders=t._data.body)}}),e.value.page*e.value.pageSize>e.value.numberOfServiceOrders&&(e.value.page=Math.ceil(e.value.numberOfServiceOrders/e.value.pageSize)|1),await C("/api/service/orders/",{method:"GET",params:{page:e.value.page,pageSize:e.value.pageSize,sortBy:e.value.sort.column,sortOrder:e.value.sort.direction,...n.value},onResponse({response:t}){t.status===200&&(e.value.orders=t._data.body),e.value.isLoading=!1}})},N=async()=>{await C("/api/service/orders/builtCount",{method:"GET",params:{PRODUCTLINE:`${n.value.PRODUCTDESC}`},onResponse({response:t}){t.status===200&&(h.value=t._data.body)}})},I=()=>{_.value.isServiceOrderModalOpen=!1},z=async()=>{I(),b()},Y=async()=>{b()},E=()=>{e.value.page=1,b()},R=async t=>{e.value.page=1;for(const o of O.value)if(o.sortable)if(o.key===t)switch(o.sortDirection){case"none":o.sortDirection="asc",e.value.sort.column=t,e.value.sort.direction="asc";break;case"asc":o.sortDirection="desc",e.value.sort.column=t,e.value.sort.direction="desc";break;default:o.sortDirection="none",e.value.sort.column="COMPLAINTNUMBER",e.value.sort.direction="desc";break}else o.sortDirection="none";x()},T=async(t,o)=>{e.value.page=1,n.value.hasOwnProperty(o)?n.value[o]=t:console.error(`Filter does not have property: ${o}`),x()},G=()=>{D.value=!0;const t={sortBy:e.value.sort.column,sortOrder:e.value.sort.direction,...n.value},o=Object.entries(t).filter(([u,c])=>c!==null).map(([u,c])=>{if(c!==null)return`${u}=${c}`}).join("&");location.href=`/api/service/orders/exportorder?${o}`,D.value=!1},K=()=>{window.open("/api/service/orders/exportcomplaints")},H=async t=>{e.value.selectedOrderId=t==null?void 0:t.uniqueID,e.value.selectedCustomerId=t==null?void 0:t.customerID,e.value.selectedCompaintNumber=t==null?void 0:t.COMPLAINTNUMBER,e.value.selectedSerialNumber=t==null?void 0:t.SERIALNO},J=async()=>{e.value.selectedCustomerId&&e.value.selectedCompaintNumber&&(_.value.isServiceOrderModalOpen=!0)};return(t,o)=>{const u=le,c=re,v=ce,P=_e,W=be,q=ve,U=ne,Q=ie,X=ye,Z=se,ee=Ce,te=he,ae=Oe;return m(),y(L,null,[r(ee,null,{default:i(()=>[r(Z,{grow:""},{default:i(()=>[r(u,{class:"gmsPurpleHeader",title:"Service Order"}),xe,r(W,null,{left:i(()=>[s("div",ge,[s("div",ke,[r(v,{label:"Product Line",name:"productLine"},{default:i(()=>[r(c,{modelValue:l(n).PRODUCTDESC,"onUpdate:modelValue":o[0]||(o[0]=a=>l(n).PRODUCTDESC=a),options:l(f).productLines.options,onChange:o[1]||(o[1]=a=>E())},null,8,["modelValue","options"])]),_:1})]),s("div",Se,[r(v,{label:"Total Built",name:"totalBuilt"},{default:i(()=>[s("div",De,g(l(h)),1)]),_:1})]),s("div",Ne,[r(v,{label:"Total Orders",name:"totalOrders"},{default:i(()=>[s("div",Ie,g(l(e).numberOfServiceOrders),1)]),_:1})]),s("div",Ee,[r(v,{label:"%",name:"percent"},{default:i(()=>[s("div",Re,g(l(F))+"% ",1)]),_:1})])])]),right:i(()=>[s("div",Te,[s("div",null,[r(P,{icon:"i-heroicons-document-text",label:"Export to Excel",color:"green",variant:"outline",ui:{base:"min-w-[210px] w-full",truncate:"flex justify-center w-full"},truncate:"",onClick:G})]),s("div",null,[r(P,{icon:"i-heroicons-eye-20-solid",label:"Preview Order Summary",variant:"outline",ui:{base:"min-w-[210px] w-full",truncate:"flex justify-center w-full"},truncate:"",onClick:K})])])]),_:1}),Pe,s("div",Ue,[(m(!0),y(L,null,V(l(S),a=>(m(),y("div",Me,[r(q,{modelValue:l(n)[a.filterKey],"onUpdate:modelValue":[oe=>l(n)[a.filterKey]=oe,E],label:a.label},null,8,["modelValue","onUpdate:modelValue","label"])]))),256))]),r(Q,{rows:l(e).orders,columns:l(O),loading:l(e).isLoading,class:"w-full",ui:{divide:"divide-gray-200 dark:divide-gray-800",th:{base:"sticky top-0 z-10",color:"bg-white dark:text-gray dark:bg-[#111827]"},td:{padding:"py-2"}},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"No items."},onSelect:H,onDblclick:J},me({_:2},[V(l(O),a=>({name:`${a.key}-header`,fn:i(()=>[a.key==="failure"?(m(),y("div",we,[r(U,{onHandleSortingButton:R,onHandleInputChange:T,label:a.label,sortable:a.sortable,"sort-key":a.key,"sort-icon":(a==null?void 0:a.sortDirection)==="none"?$:(a==null?void 0:a.sortDirection)==="asc"?B:A,filterable:a.filterable,"filter-key":a.key},null,8,["label","sortable","sort-key","sort-icon","filterable","filter-key"])])):(m(),fe(U,{key:1,onHandleSortingButton:R,onHandleInputChange:T,label:a.label,sortable:a.sortable,"sort-key":a.key,"sort-icon":(a==null?void 0:a.sortDirection)==="none"?$:(a==null?void 0:a.sortDirection)==="asc"?B:A,filterable:a.filterable,"filter-key":a.key},null,8,["label","sortable","sort-key","sort-icon","filterable","filter-key"]))])}))]),1032,["rows","columns","loading"]),s("div",Le,[s("div",Ve,[r(X,{max:7,"page-count":l(e).pageSize,total:l(e).numberOfServiceOrders||0,modelValue:l(e).page,"onUpdate:modelValue":[o[2]||(o[2]=a=>l(e).page=a),o[3]||(o[3]=a=>Y())]},null,8,["page-count","total","modelValue"])])])]),_:1})]),_:1}),r(ae,{modelValue:l(_).isServiceOrderModalOpen,"onUpdate:modelValue":o[4]||(o[4]=a=>l(_).isServiceOrderModalOpen=a),title:"Service Order",ui:{title:"text-lg",header:{base:"flex flex-row min-h-[0] items-center",padding:"pt-5 sm:px-9"},body:{base:"gap-y-1",padding:"sm:pt-0 sm:px-9 sm:py-3 sm:pb-5"},width:"w-[1800px] sm:max-w-9xl"}},{default:i(()=>[r(te,{onClose:I,onSave:z,"form-action":null,"selected-serial":l(e).selectedSerialNumber,"selected-customer":l(e).selectedCustomerId,"selected-complaint":l(e).selectedCompaintNumber,"selected-order":l(e).selectedOrderId},null,8,["selected-serial","selected-customer","selected-complaint","selected-order"])]),_:1},8,["modelValue"])],64)}}});export{ct as default};
