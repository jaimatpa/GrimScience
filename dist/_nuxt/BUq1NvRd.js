import{_ as ve,a as _e}from"./BzVEqXPg.js";import{_ as ye,a as ke,b as he}from"./Be2iH8Rx.js";import{a as xe,_ as Ce}from"./Crp9aCmO.js";import{d as we,i as De,u as Se,a as Oe,j as Ie,r as d,k as $e,o as r,c,f as l,w as i,e as U,y as v,h as n,F as M,x as F,g as s,z as B,A as G,v as Ue,s as Me}from"./RPcYXXev.js";import{_ as Ve}from"./yGFOaDKw.js";import{_ as Pe}from"./BQUlXvKt.js";import{_ as Te}from"./lE0Kizl1.js";import{_ as ze}from"./DHKz6DHT.js";import{_ as Ee}from"./CZLIIVqG.js";import{_ as Le}from"./D923ZLaS.js";import{a as je}from"./Dw6iTx8h.js";import{u as x}from"./BqkbertX.js";const Fe={key:1,class:"px-4 py-2 gmsPurpleTitlebar"},Be=n("h2",null,"Sort",-1),Ge=[Be],Ne={class:"flex flex-row space-x-3"},qe={key:0,class:"basis-1/7 max-w-[200px]"},Re={class:"basis-1/7 max-w-[200px]"},He={class:"basis-1/7 max-w-[200px]"},Ae={class:"text-center text-bold"},Qe={key:3,class:"px-4 py-2 gmsPurpleTitlebar"},Ze={key:0,class:"px-4 py-3.5"},We={key:1,class:"flex justify-center text-center w-[53px]"},Je={key:5,class:"flex flex-col overflow-scroll"},Ke={class:"w-full mt-4 flex items-end justify-end pr-5"},Xe={class:"grid grid-cols-2 gap-5 px-5"},Ye=n("span",null,"Service Order",-1),et=n("span",null,"Quotes",-1),tt=n("span",null,"Invoices",-1),ot=n("span",null,"Site Visits",-1),st={class:"border-t-[1px] border-gray-200 mb-1 dark:border-gray-800"},at={key:0,class:"flex flex-row justify-end mr-20 mt-1"},lt={key:1},nt={class:"mt-3 w-[120px]"},rt="i-heroicons-bars-arrow-up-20-solid",it="i-heroicons-bars-arrow-down-20-solid",ut="i-heroicons-arrows-up-down-20-solid",xt=we({__name:"CustomerList",props:{isPage:{type:[Boolean,null]}},emits:["close","select"],setup(N,{emit:q}){const V=q;De(()=>{Q()}),Se({title:"Grimm-Customers"});const _=N,R=Oe(),H=Ie(),b=d("lookup");function P(e){b.value=e}const w=d({markets:{label:"Market",filter:"market",options:[]},professions:{label:"Profession",filter:"source",options:[]},categories:{label:"Category",filter:"ParadynamixCatagory",options:[]},conferences:{label:"Conference",filter:"SourceConfrence",options:[]},usstates:{label:"State",filter:"state",api:"/api/common/usstates",options:[]}}),t=d({defaultColumns:[{key:"number",label:"Number",sortable:!0,sortDirection:"none",filterable:!0},{key:"fname",label:"First",sortable:!0,sortDirection:"none",filterable:!0},{key:"lname",label:"Last",sortable:!0,sortDirection:"none",filterable:!0},{key:"company1",label:"Company",sortable:!0,sortDirection:"none",filterable:!0},{key:"homephone",label:"HomePhone",sortable:!0,sortDirection:"none",filterable:!0},{key:"workphone",label:"WorkPhone",sortable:!0,sortDirection:"none",filterable:!0},{key:"state",label:"State",sortable:!0,sortDirection:"none",filterable:!0},{key:"zip",label:"Zip",sortable:!0,sortDirection:"none",filterable:!0},{key:"edit",label:"Edit",kind:"actions"},{key:"delete",label:"Delete",kind:"actions"}],page:1,pageSize:50,numberOfCustomers:0,customers:[],selectedCustomerId:null,selectCustomer:null,sort:{column:"UniqueID",direction:"asc"},isLoading:!1}),u=d({isCustomerModalOpen:!1,isOrderDetailModalOpen:!1,isQuoteDetailModalOpen:!1,isServiceOrderDetailModalOpen:!1,isSiteVisitModalOpen:!1,modalTitle:"New Customer"}),p=d({market:null,source:null,ParadynamixCatagory:null,SourceConfrence:null,number:null,fname:null,lname:null,company1:null,homephone:null,workphone:null,state:null,zip:null}),A=d(t.value.defaultColumns),D=d(!1),S=$e(()=>t.value.defaultColumns.filter(e=>A.value.includes(e)));Object.entries(R.query).forEach(([e,o])=>{switch(e.toLowerCase()){case"page":t.value.page=Number(o);break;case"pagesize":t.value.pageSize=Number(o);break;case"sortby":t.value.sort.column=o;break;case"sortorder":t.value.sort.direction=o;break}});const Q=async()=>{var e;f();for(const o in w.value){const k=((e=w.value[o])==null?void 0:e.api)??`/api/customers/${o}`;await x(k,{method:"GET",onResponse({response:m}){m.status===200&&(w.value[o].options=[null,...m._data.body])}})}},f=async()=>{if(t.value.isLoading=!0,await x("/api/customers/numbers",{method:"GET",params:{...p.value},onResponse({response:e}){e.status===200&&(t.value.numberOfCustomers=e._data.body)}}),t.value.numberOfCustomers===0){t.value.customers=[],t.value.numberOfCustomers=0,t.value.isLoading=!1;return}t.value.page*t.value.pageSize>t.value.numberOfCustomers&&(t.value.page=Math.ceil(t.value.numberOfCustomers/t.value.pageSize)|1),await x("/api/customers/",{method:"GET",params:{page:t.value.page,pageSize:t.value.pageSize,sortBy:t.value.sort.column,sortOrder:t.value.sort.direction,...p.value},onResponse({response:e}){e.status===200&&(t.value.customers=e._data.body),t.value.isLoading=!1}})},Z=()=>{t.value.selectedCustomerId=null,u.value.modalTitle="New Customer",u.value.isCustomerModalOpen=!0},W=e=>{t.value.selectedCustomerId=e==null?void 0:e.UniqueID,u.value.modalTitle="Edit",u.value.isCustomerModalOpen=!0},J=async e=>{await x(`/api/customers/${e==null?void 0:e.UniqueID}`,{method:"DELETE",onResponse({response:o}){o.status===200&&(H.add({title:"Success",description:o._data.message,icon:"i-heroicons-trash-solid",color:"green"}),f())}})},O=()=>{u.value.isCustomerModalOpen=!1},K=async()=>{O(),f()},X=async()=>{f()},T=()=>{t.value.page=1,f()},Y=async e=>{t.value.page=1;for(const o of S.value)if(o.sortable)if(o.key===e)switch(o.sortDirection){case"none":o.sortDirection="asc",t.value.sort.column=e,t.value.sort.direction="asc";break;case"asc":o.sortDirection="desc",t.value.sort.column=e,t.value.sort.direction="desc";break;default:o.sortDirection="none",t.value.sort.column="UniqueID",t.value.sort.direction="asc";break}else o.sortDirection="none";f()},ee=async(e,o)=>{t.value.page=1,p.value.hasOwnProperty(o)?p.value[o]=e:console.error(`Filter does not have property: ${o}`),f()},te=async()=>{D.value=!0;const e={sortBy:t.value.sort.column,sortOrder:t.value.sort.direction,...p.value},o=Object.entries(e).filter(([k,m])=>m!==null).map(([k,m])=>{if(m!==null)return`${k}=${m}`}).join("&");location.href=`/api/customers/exportlist?${o}`,D.value=!1},oe=async()=>{await x("/api/customers/invoices",{method:"GET",params:{customerid:t.value.selectedCustomerId},onResponse({response:e}){e.status===200&&(y.value.invoices=e._data.body)}})},se=async()=>{await x("/api/sitevisit/sitevisit",{method:"GET",params:{CustomerID:t.value.selectedCustomerId},onResponse({response:e}){e.status===200&&(I.value.options=e._data.body)}})},ae=async e=>{t.value.selectedCustomerId=e==null?void 0:e.UniqueID,t.value.customers.forEach(o=>{o.UniqueID===e.UniqueID?o.class="bg-gray-200":delete o.class}),t.value.selectCustomer=e,await oe(),await se()},y=d({defaultColumns:[{key:"invoicedate",label:"Date"},{key:"orderid",label:"#"},{key:"status",label:"Status"}],invoices:[],selectedInvoice:null,isLoading:!1}),I=d({defaultColumns:[{key:"VisitDate",label:"Date"},{key:"VisitNumber",label:"#"},{key:"Status",label:"Status"}],options:[],selectedOption:null,isLoading:!1}),le=e=>{y.value.selectedInvoice=e},ne=()=>{y.value.selectedInvoice&&(u.value.isOrderDetailModalOpen=!0)},re=()=>{const e=t.value.selectCustomer,o=`#${e==null?void 0:e.number} ${e==null?void 0:e.fname} ${e==null?void 0:e.lname}`;V("select",o),V("close")},ie=async()=>{t.value.selectedCustomerId&&(u.value.modalTitle="Edit",u.value.isCustomerModalOpen=!0)},z=d([{key:"id",label:"Date"},{key:"period",label:"#"},{key:"title",label:"Status"}]);return(e,o)=>{const k=ve,m=ye,$=xe,ue=Ce,h=Me,ce=Ve,de=ke,E=Pe,C=he,pe=Te,me=_e,be=ze,fe=Ee,L=Le,ge=je;return r(),c(M,null,[l(be,null,{default:i(()=>[l(me,{grow:""},{default:i(()=>[_.isPage?(r(),U(k,{key:0,class:"gmsPurpleHeader",title:"Customer List"})):v("",!0),_.isPage?(r(),c("div",Fe,Ge)):v("",!0),_.isPage?(r(),U(ce,{key:2},{left:i(()=>[n("div",Ne,[(r(!0),c(M,null,F(Object.entries(s(w)),([a,g])=>(r(),c(M,{key:a},[g.options.length>1?(r(),c("div",qe,[l($,{label:g.label,name:a},{default:i(()=>[l(m,{modelValue:s(p)[`${g.filter}`],"onUpdate:modelValue":j=>s(p)[`${g.filter}`]=j,options:g.options,onChange:o[0]||(o[0]=j=>T())},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label","name"])])):v("",!0)],64))),128)),n("div",Re,[l($,{label:"Zip",name:"zip"},{default:i(()=>[l(ue,{modelValue:s(p).zip,"onUpdate:modelValue":[o[1]||(o[1]=a=>s(p).zip=a),o[2]||(o[2]=a=>T())]},null,8,["modelValue"])]),_:1})]),n("div",He,[l($,{label:"Quantity",name:"Quantity"},{default:i(()=>[n("div",Ae,B(s(t).numberOfCustomers),1)]),_:1})])])]),right:i(()=>[l(h,{color:"green",variant:"outline",loading:s(D),label:"Export to Excel","trailing-icon":"i-heroicons-document-text",onClick:te},null,8,["loading"]),l(h,{color:"green",variant:"outline",label:"New customer","trailing-icon":"i-heroicons-plus",onClick:o[3]||(o[3]=a=>Z())})]),_:1})):v("",!0),_.isPage?(r(),c("div",Qe,[n("button",{class:G([{"bg-white text-black":s(b)==="lookup",gmsPurpleTitlebar:s(b)!=="lookup"},"px-4 py-0.5 focus:outline-none rounded-md"]),onClick:o[4]||(o[4]=a=>P("lookup"))}," Lookup ",2),n("button",{class:G([{"bg-white text-black":s(b)==="history",gmsPurpleTitlebar:s(b)!=="history"},"px-4 py-0.5 ml-2 focus:outline-none rounded-md"]),onClick:o[5]||(o[5]=a=>P("history"))}," Customer History ",2)])):v("",!0),s(b)==="lookup"?(r(),U(C,{key:4,rows:s(t).customers,columns:s(S),loading:s(t).isLoading,class:"w-full",ui:{divide:"divide-gray-200 dark:divide-gray-800",th:{base:"sticky top-0 z-10",color:"bg-white dark:text-gray dark:bg-[#111827]",padding:"p-0"},td:{padding:"py-1"}},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"No items."},onSelect:ae,onDblclick:ie},Ue({"edit-data":i(({row:a})=>[l(E,{text:"Edit",class:"flex justify-center"},{default:i(()=>[l(h,{color:"gray",variant:"ghost",icon:"i-heroicons-pencil-square",onClick:g=>W(a)},null,8,["onClick"])]),_:2},1024)]),"delete-data":i(({row:a})=>[l(E,{text:"Delete",class:"flex justify-center"},{default:i(()=>[l(h,{color:"gray",variant:"ghost",icon:"i-heroicons-trash",onClick:g=>J(a)},null,8,["onClick"])]),_:2},1024)]),_:2},[F(s(S),a=>({name:`${a.key}-header`,fn:i(()=>[a.kind!=="actions"?(r(),c("div",Ze,[l(de,{onHandleSortingButton:Y,onHandleInputChange:ee,label:a.label,sortable:a.sortable,"sort-key":a.key,"sort-icon":(a==null?void 0:a.sortDirection)==="none"?ut:(a==null?void 0:a.sortDirection)==="asc"?rt:it,filterable:a.filterable,"filter-key":a.key},null,8,["label","sortable","sort-key","sort-icon","filterable","filter-key"])])):(r(),c("div",We,B(a.label),1))])}))]),1032,["rows","columns","loading"])):(r(),c("div",Je,[n("div",Ke,[l(h,{icon:"i-f7-arrow-clockwise",variant:"outline",color:"green",label:"Refresh",ui:{base:"w-fit",truncate:"flex justify-center w-full"},truncate:""})]),n("div",Xe,[n("div",null,[Ye,l(C,{columns:s(z),rows:[],ui:{wrapper:"h-56 border-2 border-gray-300 dark:border-gray-700",th:{base:"sticky top-0 z-10",color:"bg-white dark:text-gray dark:bg-[#111827]",padding:"p-1"}}},null,8,["columns"])]),n("div",null,[et,l(C,{columns:s(z),rows:[],ui:{wrapper:"h-56 border-2 border-gray-300 dark:border-gray-700",th:{base:"sticky top-0 z-10",color:"bg-white dark:text-gray dark:bg-[#111827]",padding:"p-1"}}},null,8,["columns"])]),n("div",null,[tt,l(C,{columns:s(y).defaultColumns,rows:s(y).invoices,ui:{wrapper:"h-56 border-[1px] border-gray-400 dark:border-gray-700",tr:{active:"hover:bg-gray-200 dark:hover:bg-gray-800/50"},th:{padding:"p-1",base:"sticky top-0 z-10",color:"bg-white dark:text-gray dark:bg-[#111827]"},td:{padding:"p-1"},checkbox:{padding:"p-1 w-[10px]"}},onSelect:le,onDblclick:ne},null,8,["columns","rows"])]),n("div",null,[ot,l(C,{columns:s(I).defaultColumns,rows:s(I).options,ui:{wrapper:"h-56 border-[1px] border-gray-400 dark:border-gray-700",tr:{active:"hover:bg-gray-200 dark:hover:bg-gray-800/50"},th:{padding:"p-1",base:"sticky top-0 z-10",color:"bg-white dark:text-gray dark:bg-[#111827]"},td:{padding:"p-1"},checkbox:{padding:"p-1 w-[10px]"}}},null,8,["columns","rows"])])])])),n("div",st,[_.isPage&&s(b)==="lookup"?(r(),c("div",at,[l(pe,{max:7,"page-count":s(t).pageSize,total:s(t).numberOfCustomers|0,modelValue:s(t).page,"onUpdate:modelValue":[o[6]||(o[6]=a=>s(t).page=a),o[7]||(o[7]=a=>X())]},null,8,["page-count","total","modelValue"])])):v("",!0),_.isPage?v("",!0):(r(),c("div",lt,[n("div",nt,[l(h,{icon:"i-heroicons-cursor-arrow-ripple",variant:"outline",color:"green",label:"Select",ui:{base:"w-full",truncate:"flex justify-center w-full"},truncate:"",onClick:re})])]))])]),_:1})]),_:1}),l(L,{modelValue:s(u).isCustomerModalOpen,"onUpdate:modelValue":o[8]||(o[8]=a=>s(u).isCustomerModalOpen=a),title:s(u).modalTitle,ui:{title:"text-lg",header:{base:"flex flex-row min-h-[0] items-center",padding:"pt-5 sm:px-9"},body:{base:"gap-y-1",padding:"sm:pt-0 sm:px-9 sm:py-3 sm:pb-5"},width:"w-[1000px] sm:max-w-7xl"}},{default:i(()=>[l(fe,{onClose:O,onSave:K,"selected-customer":s(t).selectedCustomerId,"is-modal":!0},null,8,["selected-customer"])]),_:1},8,["modelValue","title"]),l(L,{modelValue:s(u).isOrderDetailModalOpen,"onUpdate:modelValue":o[9]||(o[9]=a=>s(u).isOrderDetailModalOpen=a),title:"Order",ui:{title:"text-lg",header:{base:"flex flex-row min-h-[0] items-center",padding:"pt-5 sm:px-9"},body:{base:"gap-y-1",padding:"sm:pt-0 sm:px-9 sm:py-3 sm:pb-5"},width:"w-[1800px] sm:max-w-9xl"}},{default:i(()=>[l(ge,{"selected-customer":s(t).selectedCustomerId,"selected-order":s(y).selectedInvoice.orderid,onClose:O},null,8,["selected-customer","selected-order"])]),_:1},8,["modelValue"])],64)}}});export{xt as _};
