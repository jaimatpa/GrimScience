import{_ as ee,a as oe}from"./BzVEqXPg.js";import{d as J,j as Q,l as te,r as f,m as se,o as k,c as H,h as n,f as s,g as t,p as Y,e as q,F as z,w as c,q as ae,s as X,t as le,i as ne,u as ie,a as re,k as de,v as ue,x as ce}from"./RPcYXXev.js";import{_ as me}from"./yGFOaDKw.js";import{_ as pe}from"./OsgMrgDf.js";import{_ as _e,a as fe,b as be}from"./Be2iH8Rx.js";import{_ as ge}from"./lE0Kizl1.js";import{_ as ve}from"./DHKz6DHT.js";import{_ as ye}from"./DBeKXjhb.js";import{_ as he,a as xe,b as Ce}from"./Crp9aCmO.js";import{_ as ke}from"./C1sp2X5w.js";import{_ as Me}from"./BUq1NvRd.js";import{_ as Z}from"./D923ZLaS.js";import{L as Ve,u as x}from"./BqkbertX.js";import"./B4XmkEM1.js";import"./BYchAQ3Y.js";import"./DTMMRf-M.js";import"./N6g2mK6h.js";import"./BQUlXvKt.js";import"./CBKg8vbb.js";import"./CZLIIVqG.js";import"./CtWjGfD-.js";import"./DFiUDov5.js";import"./Dw6iTx8h.js";import"./CZ9EiQCe.js";import"./rJN6zrQ_.js";import"./CIB32lOs.js";import"./3snQ80t5.js";import"./E1zpYRWT.js";const Ee=ae(ye),Se={class:"vl-parent"},De={class:"flex flex-col space-y-4"},we={class:"flex flex-row space-x-2"},Ue={class:"w-full"},Te={class:"flex flex-row space-x-2"},Oe=n("div",{class:"min-w-[200px] text-center font-bold px-3 py-1 bg-slate-300"}," Vendor ",-1),$e={class:"w-full"},Ae={class:"flex flex-row justify-between"},Ie={class:"flex flex-col space-y-2"},Ne={class:"flex flex-col space-y-3"},Re={class:"min-w-[200px]"},Be={class:"min-w-[200px]"},Fe={class:"flex flex-col space-y-3"},Pe={class:"min-w-[200px]"},Le={class:"min-w-[200px]"},Ge={class:"flex flex-col space-y-3"},He={class:"min-w-[200px]"},qe={class:"min-w-[200px]"},ze={class:"flex flex-col gap-y-4"},Ye={class:"mt-2"},je={class:"mt-2"},Ke={class:"mt-2"},We={class:"mt-2"},Je={class:"w-full"},Qe={class:"flex justify-end gap-3"},Xe=J({__name:"MessageForm",props:{selectedCustomer:{type:[String,Number,null],required:!0},isModal:{type:[Boolean]}},emits:["close","save"],setup($,{emit:A}){const S=A,e=$,p=Q(),C=te(),M=le(),g=new Date;String(g.getDate()).padStart(2,"0"),String(g.getMonth()+1).padStart(2,"0"),g.getFullYear(),String(g.getHours()).padStart(2,"0"),String(g.getMinutes()).padStart(2,"0");const v=f(!1),b=f(!0),I=f([]),y=f({type:"home",number:null}),V=f([]),d=se({CUSTOMER:null,vendor:null,NAME:null,COMPANY:null,TAKENBY:null,DATE:null,MESSAGE:null,HOME:null,For:null,TIME:null}),N=async()=>{v.value=!0,await x(`/api/customers/messages/${e.selectedCustomer}`,{method:"GET",onResponse({response:u}){if(u.status===200){v.value=!1,b.value=!0;for(const o in u._data.body)u._data.body[o]!==void 0&&(d[o]=u._data.body[o])}},onResponseError({}){b.value=!1}}),D()},D=async()=>{v.value=!0,await x("/api/customers/markets",{method:"GET",onResponse({response:u}){u.status===200&&(I.value=u._data.body)}}),await w(),v.value=!1},w=async()=>{await x("/api/tbl/tblEmployee?ACTIVE=1",{method:"GET",onResponse({response:u}){var o;if(u.status===200){const h=(o=u._data)==null?void 0:o.body;if(h!=null&&h.length){const _=h.map(m=>`#${m.payrollnumber||"n/a"} ${m.fname||""} ${m.lname||""}`);return V.value=_,_}}}})},U=u=>[],R=async()=>{var u;(u=M==null?void 0:M.vnode)!=null&&u.props.onClose?S("close"):C.go(-1)},B=async u=>{e.selectedCustomer===null?await x("/api/customers/messages",{method:"POST",body:u.data,onResponse({response:o}){o.status===200&&p.add({title:"Success",description:o._data.message,icon:"i-heroicons-check-circle",color:"green"})}}):await x(`/api/customers/messages/${e.selectedCustomer}`,{method:"PUT",body:u.data,onResponse({response:o}){o.status===200&&p.add({title:"Success",description:o._data.message,icon:"i-heroicons-check-circle",color:"green"})}}),S("save")},l=f(!1),i=()=>{l.value=!0},F=async u=>{d.CUSTOMER=u},E=async()=>{l.value=!1};return e.selectedCustomer!==null?N():D(),(u,o)=>{const h=Ee,_=he,m=xe,T=_e,P=ke,O=X,L=Ce,a=Me,G=Z;return k(),H(z,null,[n("div",Se,[s(t(Ve),{active:t(v),"onUpdate:active":o[0]||(o[0]=r=>Y(v)?v.value=r:null),"is-full-page":!0,color:"#000000",backgroundColor:"#1B2533",loader:"dots"},null,8,["active"])]),!e.isModal&&!t(b)?(k(),q(h,{key:0,name:"Customer not found",message:"The customer you are looking for does not exist",to:"/customers/customers/list"})):(k(),H(z,{key:1},[s(L,{validate:U,"validate-on":["submit"],state:t(d),class:"space-y-4",onSubmit:B},{default:c(()=>[n("div",De,[n("div",we,[n("div",{class:"min-w-[200px] cursor-pointer text-center font-bold px-3 py-1 bg-slate-300",onClick:i}," Customer "),n("div",Ue,[s(_,{modelValue:t(d).CUSTOMER,"onUpdate:modelValue":o[1]||(o[1]=r=>t(d).CUSTOMER=r)},null,8,["modelValue"])])]),n("div",Te,[Oe,n("div",$e,[s(_,{modelValue:t(d).vendor,"onUpdate:modelValue":o[2]||(o[2]=r=>t(d).vendor=r)},null,8,["modelValue"])])]),n("div",Ae,[n("div",Ie,[n("div",Ne,[n("div",Re,[s(m,{label:"Name",name:"name"},{default:c(()=>[s(_,{modelValue:t(d).NAME,"onUpdate:modelValue":o[3]||(o[3]=r=>t(d).NAME=r),placeholder:""},null,8,["modelValue"])]),_:1})]),n("div",Be,[s(m,{label:"Company",name:"company"},{default:c(()=>[s(_,{modelValue:t(d).COMPANY,"onUpdate:modelValue":o[4]||(o[4]=r=>t(d).COMPANY=r),placeholder:""},null,8,["modelValue"])]),_:1})])]),n("div",Fe,[n("div",Pe,[s(m,{label:"For",name:"for"},{default:c(()=>[s(T,{modelValue:t(d).For,"onUpdate:modelValue":o[5]||(o[5]=r=>t(d).For=r),options:t(V)},null,8,["modelValue","options"])]),_:1})]),n("div",Le,[s(m,{label:"By",name:"by"},{default:c(()=>[s(T,{modelValue:t(d).TAKENBY,"onUpdate:modelValue":o[6]||(o[6]=r=>t(d).TAKENBY=r),options:t(V)},null,8,["modelValue","options"])]),_:1})])]),n("div",Ge,[n("div",He,[s(m,{label:"Date",name:"date"},{default:c(()=>[s(_,{modelValue:t(d).DATE,"onUpdate:modelValue":o[7]||(o[7]=r=>t(d).DATE=r),placeholder:""},null,8,["modelValue"])]),_:1})]),n("div",qe,[s(m,{label:"Time",name:"time"},{default:c(()=>[s(_,{modelValue:t(d).TIME,"onUpdate:modelValue":o[8]||(o[8]=r=>t(d).TIME=r),placeholder:""},null,8,["modelValue"])]),_:1})])])]),n("div",ze,[n("div",null,[s(m,{label:"Home",name:"phone"},{default:c(()=>[n("div",Ye,[s(_,{modelValue:t(d).HOME,"onUpdate:modelValue":o[9]||(o[9]=r=>t(d).HOME=r),placeholder:""},null,8,["modelValue"])])]),_:1})]),n("div",null,[s(m,{label:"Work",name:"phone"},{default:c(()=>[n("div",je,[s(_,{modelValue:t(y).number,"onUpdate:modelValue":o[10]||(o[10]=r=>t(y).number=r),placeholder:""},null,8,["modelValue"])])]),_:1})]),n("div",null,[s(m,{label:"Cell",name:"phone"},{default:c(()=>[n("div",Ke,[s(_,{modelValue:t(y).number,"onUpdate:modelValue":o[11]||(o[11]=r=>t(y).number=r),placeholder:""},null,8,["modelValue"])])]),_:1})]),n("div",null,[s(m,{label:"Other",name:"phone"},{default:c(()=>[n("div",We,[s(_,{modelValue:t(y).number,"onUpdate:modelValue":o[12]||(o[12]=r=>t(y).number=r),placeholder:""},null,8,["modelValue"])])]),_:1})])])]),n("div",Je,[s(m,{label:"Message",name:"mesage"},{default:c(()=>[s(P,{modelValue:t(d).MESSAGE,"onUpdate:modelValue":o[13]||(o[13]=r=>t(d).MESSAGE=r),color:"white",variant:"outline",placeholder:"Please leave your message..."},null,8,["modelValue"])]),_:1})])]),n("div",Qe,[s(O,{label:$.isModal?"Cancel":"Go back",color:"gray",variant:"ghost",onClick:R},null,8,["label"]),s(O,{type:"submit",label:"Save",color:"black"})])]),_:1},8,["state"]),s(G,{modelValue:t(l),"onUpdate:modelValue":o[14]||(o[14]=r=>Y(l)?l.value=r:null),title:"Select Customer",ui:{title:"text-lg",header:{base:"flex flex-row min-h-[0] items-center",padding:"pt-5 sm:px-9"},body:{base:"gap-y-1",padding:"sm:pt-0 sm:px-9 sm:py-3 sm:pb-5"},width:"w-[1200px] sm:max-w-8xl"}},{default:c(()=>[s(a,{onSelect:F,onClose:E})]),_:1},8,["modelValue"])],64))],64)}}}),Ze=n("div",{class:"px-4 py-2 gmsPurpleTitlebar"},[n("h2",null,"Lookup")],-1),eo={class:"border-t-[1px] border-gray-200 mb-1 dark:border-gray-800"},oo={class:"flex flex-row justify-end mr-20 mt-1"},j="i-heroicons-bars-arrow-up-20-solid",K="i-heroicons-bars-arrow-down-20-solid",W="i-heroicons-arrows-up-down-20-solid",To=J({__name:"list",setup($){ne(()=>{v()}),ie({title:"Grimm-Customers"});const A=re(),S=Q(),e=f({defaultColumns:[{key:"DATE",label:"Date",sortable:!0,sortDirection:"none",filterable:!0},{key:"CUSTOMER",label:"Customer",sortable:!0,sortDirection:"none",filterable:!0},{key:"VENDOR",label:"Vendor",sortable:!0,sortDirection:"none",filterable:!0},{key:"NAME",label:"Name",sortable:!0,sortDirection:"none",filterable:!0},{key:"FOR",label:"For",sortable:!0,sortDirection:"none",filterable:!0,filterOptions:[]},{key:"TAKENBY",label:"Taken By",sortable:!0,sortDirection:"none",filterable:!0,filterOptions:[]},{key:"actions",label:"Actions"}],page:1,pageSize:50,numberOfMessages:0,messages:[],selectedMessageId:null,sort:{column:"UniqueID",direction:"asc"},isLoading:!1}),p=f({isCustomerModalOpen:!1,modalTitle:"New Message",modalDescription:"Add a new message to your database"}),C=f({date:null,customer:null,vendor:null,name:null,for:null,takenby:null}),M=f(e.value.defaultColumns);f(!1);const g=de(()=>e.value.defaultColumns.filter(l=>M.value.includes(l)));Object.entries(A.query).forEach(([l,i])=>{switch(l.toLowerCase()){case"page":e.value.page=Number(i);break;case"pagesize":e.value.pageSize=Number(i);break;case"sortby":e.value.sort.column=i;break;case"sortorder":e.value.sort.direction=i;break}});const v=async()=>{b()},b=async()=>{if(e.value.isLoading=!0,await x("/api/customers/messages/numbers",{method:"GET",params:{...C.value},onResponse({response:l}){l.status===200&&(e.value.numberOfMessages=l._data.body)}}),e.value.numberOfMessages===0){e.value.messages=[],e.value.numberOfMessages=0,e.value.isLoading=!1;return}e.value.page*e.value.pageSize>e.value.numberOfMessages&&(e.value.page=Math.ceil(e.value.numberOfMessages/e.value.pageSize)|1),await x("/api/customers/messages",{method:"GET",params:{page:e.value.page,pageSize:e.value.pageSize,sortBy:e.value.sort.column,sortOrder:e.value.sort.direction,...C.value},onResponse({response:l}){l.status===200&&(e.value.messages=l._data.body),e.value.isLoading=!1}})},I=()=>{e.value.selectedMessageId=null,p.value.modalTitle="New Message",p.value.modalDescription="Add a new message to your database",p.value.isCustomerModalOpen=!0},y=l=>{e.value.selectedMessageId=l==null?void 0:l.UniqueID,p.value.modalTitle="Edit",p.value.modalDescription="Edit message",p.value.isCustomerModalOpen=!0},V=async l=>{await x(`/api/customers/messages/${l==null?void 0:l.UniqueID}`,{method:"DELETE",onResponse({response:i}){i.status===200&&(S.add({title:"Success",description:i._data.message,icon:"i-heroicons-trash-solid",color:"green"}),b())}})},d=()=>{p.value.isCustomerModalOpen=!1},N=async()=>{d(),b()},D=async()=>{b()},w=async l=>{e.value.page=1;for(const i of g.value)if(i.sortable)if(i.key===l)switch(i.sortDirection){case"none":i.sortDirection="asc",e.value.sort.column=l,e.value.sort.direction="asc";break;case"asc":i.sortDirection="desc",e.value.sort.column=l,e.value.sort.direction="desc";break;default:i.sortDirection="none",e.value.sort.column="UniqueID",e.value.sort.direction="asc";break}else i.sortDirection="none";b()},U=async(l,i)=>{e.value.page=1,C.value.hasOwnProperty(i)?C.value[i]=l:console.error(`Filter does not have property: ${i}`),b()},R=async l=>{e.value.selectedMessageId=l==null?void 0:l.UniqueID},B=async()=>{e.value.selectedMessageId&&(p.value.modalTitle="Edit",p.value.modalDescription="Edit message")};return(l,i)=>{const F=ee,E=X,u=me,o=pe,h=fe,_=be,m=ge,T=oe,P=ve,O=Xe,L=Z;return k(),H(z,null,[s(P,null,{default:c(()=>[s(T,{grow:""},{default:c(()=>[s(F,{class:"gmsPurpleHeader",title:"Customer Messages"}),Ze,s(u,{class:"gmsPurpleToolbar"},{right:c(()=>[s(E,{color:"green",variant:"outline",label:"New message","trailing-icon":"i-heroicons-plus",onClick:i[0]||(i[0]=a=>I())})]),_:1}),s(_,{rows:t(e).messages,columns:t(g),loading:t(e).isLoading,class:"w-full",ui:{divide:"divide-gray-200 dark:divide-gray-800",th:{base:"sticky top-0 z-10",color:"bg-white dark:text-gray dark:bg-[#111827]"},td:{padding:"py-1"}},"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"No items."},onSelect:R,onDblclick:B},ue({"actions-data":c(({row:a})=>[s(E,{color:"gray",variant:"ghost",icon:"i-heroicons-pencil-square-20-solid",onClick:G=>y(a)},null,8,["onClick"]),s(E,{color:"gray",variant:"ghost",icon:"i-heroicons-trash-20-solid",class:"ml-2",onClick:G=>V(a)},null,8,["onClick"])]),_:2},[ce(t(g),a=>({name:`${a.key}-header`,fn:c(()=>[a.filterOptions?(k(),q(o,{key:0,onHandleSortingButton:w,onHandleInputChange:U,label:a.label,sortable:a.sortable,"sort-key":a.key,"sort-icon":(a==null?void 0:a.sortDirection)==="none"?W:(a==null?void 0:a.sortDirection)==="asc"?j:K,filterable:a.filterable,"filter-key":a.key},null,8,["label","sortable","sort-key","sort-icon","filterable","filter-key"])):(k(),q(h,{key:1,onHandleSortingButton:w,onHandleInputChange:U,label:a.label,sortable:a.sortable,"sort-key":a.key,"sort-icon":(a==null?void 0:a.sortDirection)==="none"?W:(a==null?void 0:a.sortDirection)==="asc"?j:K,filterable:a.filterable,"filter-key":a.key},null,8,["label","sortable","sort-key","sort-icon","filterable","filter-key"]))])}))]),1032,["rows","columns","loading"]),n("div",eo,[n("div",oo,[s(m,{max:7,"page-count":t(e).pageSize,total:t(e).numberOfMessages|0,modelValue:t(e).page,"onUpdate:modelValue":[i[1]||(i[1]=a=>t(e).page=a),i[2]||(i[2]=a=>D())]},null,8,["page-count","total","modelValue"])])])]),_:1})]),_:1}),s(L,{modelValue:t(p).isCustomerModalOpen,"onUpdate:modelValue":i[3]||(i[3]=a=>t(p).isCustomerModalOpen=a),title:t(p).modalTitle,description:t(p).modalDescription,ui:{title:"text-lg",header:{base:"flex flex-row min-h-[0] items-center",padding:"pt-5 sm:px-9"},body:{base:"gap-y-1",padding:"sm:pt-0 sm:px-9 sm:py-3 sm:pb-5"},width:"w-[1000px] sm:max-w-7xl"}},{default:c(()=>[s(O,{onClose:d,onSave:N,"selected-customer":t(e).selectedMessageId,"is-modal":!0},null,8,["selected-customer"])]),_:1},8,["modelValue","title","description"])],64)}}});export{To as default};
